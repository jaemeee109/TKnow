<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ticketnow.core.auth.mapper.BlacklistTokenMapper">

  <!-- Access 토큰 해시를 블랙리스트에 저장 (자동증가 PK가 있다면 useGeneratedKeys 유지) -->
  <insert id="insert"
          parameterType="ticketnow.core.auth.domain.BlacklistTokenVO"
          useGeneratedKeys="true"
          keyProperty="blackNo">
    INSERT INTO blacklist_token
      (accessTokenHash, expiresAt)
    VALUES
      (#{accessTokenHash}, #{expiresAt})
  </insert>

  <!-- 해시 존재 여부 (유효기간 내) -->
  <select id="existsByHash"
          parameterType="string"
          resultType="int">
    SELECT COUNT(1)
      FROM blacklist_token
     WHERE accessTokenHash = #{accessTokenHash}
       AND expiresAt > NOW()
  </select>

</mapper>
